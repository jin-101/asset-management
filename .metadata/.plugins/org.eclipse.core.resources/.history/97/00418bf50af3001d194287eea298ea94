<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<c:set var="path" value="${pageContext.request.contextPath}"></c:set>
<!DOCTYPE html>
<html lang="ko">
<head>
<%-- <link rel="stylesheet" href="${path}/css/empDetail.css"> --%>
<title>장비상세보기</title>
<jsp:include page="/common/common.jsp"></jsp:include>
</head>
<body>
	<header>
		<div class="container">
			
		</div>
	</header>
	<main>
		<div class="sub1">직원상세보기</div>
		<form id="detail-form" action="${path}/emp/empDetail.do" method="post" class="row g-3">
			<div class="col-12">
				<label for="EMPLOYEE_ID">EMPLOYEE_ID : </label> 
				<input type="text" id="employee_id" name="employee_id" value="${emp.employee_id}"
					readonly autocomplete='off'>
			</div>
			<div class="col-12">
				<label for="" class="form-label">First and last name</label>
				<div class="input-group">
					<span class="input-group-text">First and last name</span> 
					<input type="text" aria-label="First name" name="first_name"
						class="username form-control is-valid" required
						value="${emp.first_name}"> <input type="text"
						aria-label="Last name" name="last_name"
						class="username form-control is-valid" required
						value="${emp.last_name} ">
					<div class="valid-feedback">Looks good!</div>
				</div>
			</div>
			<div class="col-12">
				<label for="email" class="form-label">EMAIL : </label> <input
					type="email" class="aaa" name="email" class="form-control"
					id="EMAIL" placeholder="1234@jei.com" value="${emp.email}" readonly>
			</div>
			<div class="col-12">
				<label for="phone_number" class="form-label">PHONE_NUMBER</label> <input
					type="text" name="phone_number" class="form-control"
					id="PHONE_NUMBER" placeholder="010-xxxx-xxxx"
					value="${emp.phone_number}" readonly>
			</div>
			<div>
				<label for="">HIRE DATE : </label>
				<input type="date" name="hire_date" id="HIRE_DATE" class="update"
					name="hire_date" required value="${emp.hire_date}">
			</div>
			<div class="col-12">
				<label for="job_id" class="form-label">JOB ID : </label> 
				<select name="job_id">
					<c:forEach items="${jobList}" var="job">
						<option value="${job.job_id}"
							${emp.job_id == job.job_id ? "selected": ""}>${job.job_id}</option>
					</c:forEach>
				</select>
			</div>
			<div class="col-12">
				<label for="salary" class="form-label">SALARY</label> 
				<input type="text" name="salary" class="form-control update" id="SALARY"
					value="${emp.salary}">
			</div>
			<div class="col-12">
				<label for="commission_pct" class="form-label">COMMISSION PCT</label> 
				<input type="text" name="commission_pct" class="form-control update" id="COMMISSION_PCT" value="${emp.commission_pct}">
			</div>
			<div class="col-12">
				<label for="manager_id" class="form-label">MANAGER ID : </label> 
				<select name="manager_id">
					<option value="0">매니저 없음</option>
					<c:forEach items="${managerList}" var="manager">
						<option value="${manager.employee_id}"
							${emp.manager_id == manager.employee_id ? "selected": ""}>${manager.employee_id}</option>
					</c:forEach>
				</select>
			</div>
			<div class="col-12">
				<label for="department_id" class="form-label">DEPARTMENT ID : </label> 
				<select name="department_id">
					<option value="0">부서 없음</option>
					<c:forEach items="${deptList}" var="dept">
						<option value="${dept.department_id}"
							${emp.department_id == dept.department_id ? "selected": ""}>${dept.department_id}</option>
					</c:forEach>
				</select>
			</div>
			<div class="submit">
				<input type="submit" name="submit" id="submit" class="btn btn-success" value="직원정보 수정"/>
				<input type="button" id="update-restful-btn" class="btn btn-primary" value="수정 (restful)"/>
			</div>
		</form>	
		<div id="resultMsg-select-list-all"></div>
	</main>
</body>
<script>
	$(function() {
		//직원정보 수정 (update , put방식)
		//contentType 보내는 데이터의 형식이 json이다.
		$("#update-restful-btn").click(function() {
			const arr = $("#detail-form").serializeArray();
			const obj = {};
			$.each(arr, (index, item)=>{
				obj[item.name] = item.value;
			});
			$.ajax({
				url : "${path}/restfulEmp/empDetail.do/",
				method:"PUT",
				data: JSON.stringify(obj),
				contentType:"application/json",
				success:(res)=>{
					alert(res);
					location.href = "${path}/emp/empList.do";
				},
				error:(err)=>{
					console.error(err);
				}
			});
		});
	});
</script>
</html>