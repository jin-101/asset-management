<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<c:set var="path" value="${pageContext.request.contextPath}"></c:set>
<!DOCTYPE html>
<html lang="ko">
<head>
<%-- <link rel="stylesheet" href="${path}/css/empDetail.css"> --%>
<title>장비상세보기</title>
<jsp:include page="/common/common.jsp"></jsp:include>
</head>
<body>
	<header>
		<div>직원상세보기</div>
	</header>
	<main>
		<form id="detail-form" action="${path}/equi/equiDetail.do" method="post" class="row g-3">
			<div class="col-12">
				<label for="equipmentId">장비번호 : </label> 
				<input type="text" id="equipmentId" name="equipmentId" value="${equi.equipmentId}"
					disabled>
			</div>
			<div class="col-12">
				<label for="equiType" class="form-label">장비유형 : </label> 
				<select name="equiType">
					<c:forEach items="${equiTypeList}" var="eqType">
						<option value="${eqType.typeId}">${eqType.typeName}</option>
					</c:forEach>
				</select>
			</div>
			<div class="col-12">
				<label for="equiCom" class="form-label">제조회사 : </label> 
				<select name="equiCom">
					<c:forEach items="${equiCompanyList}" var="eqCom">
						<option value="${eqCom.coId}">${eqCom.coName}</option>
					</c:forEach>
				</select>
			</div>
			<div class="col-12">
				<label for="model" class="form-label">모델명 :</label> 
				<input type="text" name="model" class="form-control" id="model"
					value="${emp.salary}">
			</div>
			<div>
				<label for="">HIRE DATE : </label>
				<input type="date" name="hire_date" id="HIRE_DATE" class="update"
					name="hire_date" required value="${emp.hire_date}">
			</div>
			
			<div class="col-12">
				<label for="commission_pct" class="form-label">COMMISSION PCT</label> 
				<input type="text" name="commission_pct" class="form-control update" id="COMMISSION_PCT" value="${emp.commission_pct}">
			</div>
			<div class="col-12">
				<label for="manager_id" class="form-label">MANAGER ID : </label> 
				<select name="manager_id">
					<option value="0">매니저 없음</option>
					<c:forEach items="${managerList}" var="manager">
						<option value="${manager.employee_id}"
							${emp.manager_id == manager.employee_id ? "selected": ""}>${manager.employee_id}</option>
					</c:forEach>
				</select>
			</div>
			<div class="col-12">
				<label for="department_id" class="form-label">DEPARTMENT ID : </label> 
				<select name="department_id">
					<option value="0">부서 없음</option>
					<c:forEach items="${deptList}" var="dept">
						<option value="${dept.department_id}"
							${emp.department_id == dept.department_id ? "selected": ""}>${dept.department_id}</option>
					</c:forEach>
				</select>
			</div>
			<div class="submit">
				<input type="submit" name="submit" id="submit" class="btn btn-success" value="직원정보 수정"/>
				<input type="button" id="update-restful-btn" class="btn btn-primary" value="수정 (restful)"/>
			</div>
		</form>	
		<div id="resultMsg-select-list-all"></div>
	</main>
</body>
<script>
	$(function() {
		//직원정보 수정 (update , put방식)
		//contentType 보내는 데이터의 형식이 json이다.
		$("#update-restful-btn").click(function() {
			const arr = $("#detail-form").serializeArray();
			const obj = {};
			$.each(arr, (index, item)=>{
				obj[item.name] = item.value;
			});
			$.ajax({
				url : "${path}/restfulEmp/empDetail.do/",
				method:"PUT",
				data: JSON.stringify(obj),
				contentType:"application/json",
				success:(res)=>{
					alert(res);
					location.href = "${path}/emp/empList.do";
				},
				error:(err)=>{
					console.error(err);
				}
			});
		});
	});
</script>
</html>